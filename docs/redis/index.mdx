---
slug: /redis
---

# Redis

Redis can be used as a database, cache, streaming engine, message broker, and more

## Redis In Docker Container

Redis within a Docker container, provides a portable and isolated environment for deploying Redis-based applications

### Start Redis Docker Container 
To start Redis Stack server using the redis-stack-server image, run the following command in your terminal

```java
docker run -d --name redis-stack-server -p 6379:6379 \
redis/redis-stack-server:latest
```

:::info
You can also download sample data from the Redis University `.rdb` file as below and start a Redis server with sample data
:::

```java
# download the sample data file
wget https://storage.googleapis.com/redis-university-assets/ru101/ru101.rdb.gz

# gunzip the file
gunzip ru101.rdb.gz

# start docker container
docker run -d --name redis-stack-server -p 6379:6379 \
-v "./ru101.rdb:/data/dump.rdb" \
redis/redis-stack-server:latest
```

### Connect to Redis CLI 

You can then connect to the server using redis-cli, just as you connect to any Redis instance
```java
docker exec -it redis-stack-server redis-cli
```

## Key 
	- Unique 
	- Binary Safe - Can be anything like simple string, number to binary value
	- Key names can be up $512\text{mb}$
	- Case Sensitive


### SET Command 
	- Checks non-existence with NX 
	- Checks existence with XX 
	- Set expiration in miliseconds using PX 
	- Set expiration in seconds using EX

```java
SET key value [EX seconds] [PX miliseconds] [NX|XX]

SET customer:1000 fred
OK
```


### GET Command 

```java 
GET key 

GET customer:1000
"fred"
```


### KEYS Command 
	- Blocks database until it iterates through all keys
	- Never use in Production
	- Useful for debugging


```java 
KEYS customer:1*
1) "customer:1000"
```


### SCAN Command 
	- Blocks database but iterate over handful of keys at a time
	- Return the slot reference which you can use for subsequent call
	- May return 0 or more keys per call


```java 
SCAN slot [MATCH Pattern][COUNT count]

SCAN 0 MATCH customer:1*
1) "0"
2) 1) "customer:1000"
```

Scan will return cursor value of $0$, when it has no more keys to iterate over


### DEL Command 
	- Deletes the key, and memeory associated with it
	- Blocking Command



### UNLINK Command 
	- Unlinks the key, and memory associated with it is reclaimed by asynchronous process
	- Non Blocking Command 



### EXISTS Command 
	- Return $1$ if key exists or else returns $0$


### EXPIRE Commands
Sets/Chages expiration on key

```java
EXPIRE key seconds

EXPIRE key timestamp 

PEXPIRE key milliseconds 

PEXPIREAT key milliseconds-timestamp
```


### TTL Commands 
Examines TTL for a key

```java 
TTL key 

PTTL Key 
```


### PERSIST Command
TTL can be removed using PERSIST command. PERSIST will set the TTL to $-1$
```java
PERSIST key 
```

### TYPE Command 
Return the type of the key
```java
TYPE customer:1000
string
```


### OBJECT ENCODING Command 
Return the object encoding of the key
```java
OBJECT ENCODING user:23:visit-count
"int"
```


## String 
	- Binary safe sequence of bytes 
	- String can store numerical values, serialized JSON
	- String can even store images, videos, documents and sounds
	- API response Caching is most common usecase

```java 
SET usage:63 '{"balance": 699.99, "currency": "USD", "tier": "Premium"}' EX 7200
```


### INCR Command 
If key doesn't exist it will create a new key with value $1$
```java
INCR user:23:visit-count 
```

### INCRBY Command
```java
INCRBY user:23:credit-balance 30

INCRBY user:23:credit-balance -20
```

### INCRBYFLOAT Command
```java
INCRBYFLOAT user:23:visit-count 0.1
```


## Hashes
	- It is collection of field value pair
	- Hashes are mutable
	- Stores field value as string, which means values will not have nested array or objects
	- All hashes commands takes $O(1)$ time, except `HGETALL` which takes $O(N)$ time where $N$ is number of fields in hash
	- Typical usecases are Rate Limiting, Session Cache

### HSET Command 
```java
HSET player:42 name abc level 4 hp 4 gold 20

HSET player:42 status 0
```

### HEXISTS Command 
Returns $0$ if field doesn't exists else return $1$
```java
HEXISTS player:42 status
```

### HDEL Command
```java
HDEL player:42 status
```

### HGET Command
```java
HGET player:42 name
"abc"
```

### HGETALL Command 
```java
HGETALL player:42
1) "name"
2) "abc"
3) "level"
4) "4"
5) "hp"
6) "4"
7) "gold"
8) "20"
```

### HINCRBY Command 
```java
HINCRBY player:42 gold 120
```


## List
	- Ordered collection of Strings
	- Duplicates are allowed 
	- Elements can be added and removed at Left or Right
	- Elements can be inserted relative to another
	- Used to implement stack and queue
	- Usecases are activity stream, interprocess communication

###  RPUSH/LPUSH Command 
```java
RPUSH playlist:user2 25
(integer) 1

RPUSH playlist:user2 71
(integer) 2
```

### RPOP/LPOP Command 
```java
LPOP playlist:user2
"25"
```

### LRANGE Command 
```java
LRANGE playlist:user2 0 4
1) "71"
```

### LLEN Command 
```java
LLEN playlist:user2 
(integer) 1
```

## Set
	- Unordered collection of string 
	- Duplicates are not allowed 
	- Allows for difference, intersection and union set operations
	- Are not nested
	- Usescase are Unique Visitor


### SADD Command 
```java
SADD player:online 42
(integer) 1

SADD player:31:friends 42
(integer) 1

SADD player:31:friends 43
(integer) 1
```

### SCARD Command 
```java
SCARD player:online
(integer) 1
```

### SISMEMBER Command 
```java
SISMEMBER player:online 42
(integer) 1
```

### SINTER Command 
```java
SINTER player:31:friends player:online
1) "42"
```

### SDIFF Command 
```java
SDIFF player:31:friends player:online
1) "43"
```

### SREM Command 
```java
SREM player:31:friends 43
(integer) 1
```


## Sorted Set 
	- Ordered collection of unique members 
	- Each memeber has associated score
	- Support set operations like intersection, union and difference
	- Usecase are Priority Queue, Low Latency Leaderboards, Secondary Indexing


### ZADD Command 
```java
ZADD key score memberId

ZADD leaders:exp 0 42 
(integer) 1
```

### ZINCRBY Command 
```java
ZINCRBY leaders:exp 10 42
"10"
```

### ZRANGE Command
```java
ZRANGE leaders:exp 0 9 WITHSCORES
1) "42"
2) "10"
```

## Set Operations With Set And Sorted Set

```java
ZADD sales:judo 1500 june 2000 bill 200 mary
(integer) 3

ZADD sales:wrestling 1800 bill 1000 bob 800 mary
(integer) 3

ZINTERSTORE promo:taekwondo 2 sales:wrestling sales:judo aggregate sum
(integer) 2

ZRANGE promo:taekwondo 0 -1 WITHSCORES
1) "mary"
2) "1000"
3) "bill"
4) "3800"
```


